# V1.1 Features (Should Have)

These features add polish and security to the MVP. They can be delayed if the MVP timeline is at risk, but should be completed before public launch.

---

## 1. Spending Trends (Charts)

**Status:** Not Started  
**Estimated Time:** 4-6 hours  
**Dependencies:** Recharts library

A line graph showing "Joint Spending" over the last 3 months.

**Implementation:**

- Install: `npm install recharts`
- Create component: `/components/SpendingTrendsChart.tsx`
- Query transactions grouped by month
- Display using Recharts LineChart

---

## 2. Recurring Bill Detective

**Status:** Not Started  
**Estimated Time:** 3-4 hours  
**Dependencies:** None

Simple logic to flag transactions that happen every month (e.g., Netflix, Rent).

**Implementation:**

- Query transactions with same merchant_name and similar amount
- Check if they occur monthly (Â±3 days)
- Display in "Upcoming Bills" section on dashboard
- Algorithm: Compare last 3 months of data

---

## 3. Budget Progress Bars

**Status:** âœ… Completed (Issue #27)
**Completed:** December 2025

**Files Created:**

- `src/components/budget-settings.tsx`
- `src/components/budget-progress.tsx`
- `src/app/api/settings/budgets/route.ts`

**Features Implemented:**

- âœ… Total household budget (all spending combined)
- âœ… Category-specific budgets
- âœ… Visual progress bars with color coding
- âœ… Configurable alert thresholds (default 80%)
- âœ… Red/amber color when approaching or exceeding limits
- âœ… Days remaining in month display
- âœ… Create, update, delete budgets

---

## 4. Transaction History/Filtering

**Status:** âœ… Completed (Issue #30)  
**Completed:** December 2025  
**Files Created:**

- `src/types/filters.ts`
- `src/hooks/use-debounce.ts`
- `src/hooks/use-transaction-filters.ts`
- `src/lib/filter-utils.ts`
- `src/components/transaction-filters.tsx`
- `src/components/filtered-transactions-list.tsx`

**Features Implemented:**

- âœ… Search by merchant name and description (debounced)
- âœ… Date range filter (This Month, Last Month, Last 3/6 Months, This Year, Custom)
- âœ… Category filter dropdown
- âœ… Type filter (All / Personal / Joint)
- âœ… Amount range filter (min/max)
- âœ… Active filter chips with remove functionality
- âœ… "Clear All" button
- âœ… Result count display ("Showing X of Y")
- âœ… URL state persistence (shareable filters)
- âœ… Empty state for no matches

---

## 5. Household Settings Page

**Status:** âœ… Completed (Multiple Issues)
**Completed:** December 2025

**Route:** `/settings`

**Files Created:**

- `src/app/settings/page.tsx`
- `src/app/settings/layout.tsx`
- `src/app/settings/categories/page.tsx`
- `src/components/household-settings.tsx`
- `src/components/notification-settings.tsx`
- `src/components/budget-settings.tsx`
- `src/components/category-list.tsx`
- `src/components/category-form.tsx`

**Features Implemented:**

- âœ… Household name display
- âœ… Monthly settlement toggle
- âœ… Push notification settings (granular preferences)
- âœ… Budget management
- âœ… Category management (Issue #31)
  - View system and custom categories
  - Create, edit, delete custom categories
  - Emoji and color picker
  - Transaction reassignment on delete

---

## 6. Goal Auto-Sync

**Status:** Not Started  
**Estimated Time:** 4-6 hours  
**Dependencies:** Plaid account balance API

Goals automatically update progress by tracking balance changes in a linked savings account.

**Implementation:**

- Add field to goals table: `linked_account_id TEXT` (Plaid account ID)
- In goal creation/edit, allow selecting a savings account
- Create cron job or webhook to fetch account balance daily
- Update `current_amount` based on balance
- Show "Last synced: 2 hours ago" in UI

**Complexity:** Higher due to Plaid integration

---

## 7. "Hide from Partner" Toggle (DOCUMENTED FROM ISSUE #9 REVIEW)

**Status:** Not Started  
**Estimated Time:** 3-4 hours  
**Dependencies:** None

Users can mark individual transactions as private to hide them from their partner (e.g., surprise gifts).

**Database:** Already has `is_hidden` column âœ…

**Implementation:**

1. **RLS Policy (Keep Simple - Allow Partner to See Row):**

```sql
   -- DO NOT modify existing RLS policy
   -- Keep it as: "Users can view all household transactions"
   -- We'll handle hiding at the application layer, not database layer
```

**Why?** If RLS hides the row completely, the partner can't see it at all, which breaks the "Ghost Math" balance calculation. We need the row visible so the amount counts toward the total.

2. **Application-Level Masking (Frontend/Backend):**

   **Backend (API Route or Server Component):**

```typescript
const { data: transactions } = await supabase
  .from("transactions")
  .select("*")
  .eq("household_id", householdId);

// Mask transactions that are hidden and not yours
const maskedTransactions = transactions.map((txn) => {
  if (txn.is_hidden && txn.user_id !== currentUserId) {
    return {
      ...txn,
      merchant_name: "[Private Transaction] ðŸ”’",
      description: "[Private Transaction]",
      category_id: null, // Don't reveal category
    };
  }
  return txn;
});
```

**Frontend:**

```typescript
<TransactionRow
  merchant={
    transaction.is_hidden && transaction.user_id !== currentUserId
      ? "[Private Transaction] ðŸ”’"
      : transaction.merchant_name
  }
  amount={transaction.amount} // Always visible
  date={transaction.date} // Always visible
/>
```

3. **Add Toggle Button:**

   - On each transaction card: "Hide from Partner" toggle
   - Update `is_hidden` column when toggled
   - Show confirmation: "This will hide merchant details from your partner. Amount and date remain visible."

**Critical Implementation Note:**

- Do NOT use RLS to hide rows completely (breaks balance calculation)
- Instead: RLS allows partner to see the row, but application logic masks sensitive fields
- Partner still sees: amount, date, "is_joint" status
- Partner does NOT see: merchant_name, description, category (if hidden)
- This preserves the "Ghost Math" fix from your PRD

- **Merchant Masking Logic:**
  - If `is_hidden = true` AND `user_id != auth.uid()`:
    - Display: "[Private Transaction] ðŸ”’"
    - Hide: merchant_name, category
    - Show: amount, date
  - This preserves "Net Worth" accuracy (Ghost Math Fix)

**UI Flow:**

1. User clicks "Hide from Partner" on transaction
2. Confirmation modal: "This will hide the merchant details from your partner. The amount and date will still be visible."
3. Update `is_hidden = true`
4. Partner sees: "-$100 [Private Transaction] ðŸ”’ - Personal"

---

## 8. Single-Use Invite Codes (DOCUMENTED FROM ISSUE #9 REVIEW)

**Status:** Not Started  
**Estimated Time:** 2-3 hours  
**Dependencies:** None

Household invite codes can only be used once for security.

**Database Changes:**

```sql
ALTER TABLE public.households
ADD COLUMN invite_used_at TIMESTAMPTZ,
ADD COLUMN invite_used_by UUID REFERENCES public.users(id);
```

**Implementation:**

1. When user joins via `/join/[code]`:

```typescript
// Check if code already used
if (household.invite_used_at) {
  redirect("/invite-already-used");
}

// Mark as used when joining
await supabase
  .from("households")
  .update({
    invite_used_at: new Date().toISOString(),
    invite_used_by: user.id,
  })
  .eq("id", household.id);
```

2. Add "Regenerate Invite Code" button in Household Settings:

```typescript
const newCode = "JOIN-" + generateRandomString(6);
await supabase
  .from("households")
  .update({
    invite_code: newCode,
    invite_used_at: null,
    invite_used_by: null,
  })
  .eq("id", household.id);
```

**Benefits:**

- Prevents random people from joining if code leaks
- Limits household to exactly 2 people
- Better security hygiene

**Error Messages:**

- "This invite code has already been used. Ask your partner to generate a new one."

---

## 9. Robust Plaid Error Handling (Deferred from #21)

**Status:** Not Started  
**Estimated Time:** 3-4 hours  
**Dependencies:** Plaid webhooks (optional)

Advanced error handling for Plaid integration beyond basic try/catch.

**Features to Implement:**

1. **Re-authentication Flow:**

   - Detect `ITEM_LOGIN_REQUIRED` error
   - Update `linked_accounts.status = 'reauth_required'`
   - Show "Reconnect" button on dashboard
   - Use Plaid Link in "update mode" to re-authenticate
   - Reset status to `active` on success

2. **Reconnect Button:**

```typescript
// Plaid Link update mode
const { open } = usePlaidLink({
  token: linkToken,
  onSuccess: handleReconnectSuccess,
});
```

3. **Error Code Handling:**
   | Error Code | Action |
   |------------|--------|
   | `ITEM_LOGIN_REQUIRED` | Show reconnect button |
   | `INSTITUTION_NOT_RESPONDING` | Show "try again later" message |
   | `INVALID_CREDENTIALS` | Prompt to re-link |
   | `PRODUCT_NOT_READY` | Show "check back soon" message |

**Implementation Notes:**

- Consider Plaid webhooks for real-time error detection
- May need to poll `/item/get` endpoint periodically
- Log errors to analytics for monitoring

**What Was Completed in Phase 2:**

- âœ… Basic error handling (try/catch with user messages)
- âœ… Loading states during linking and syncing
- âœ… Last synced timestamp display
- âœ… Unlink account functionality

---

## 10. Cursor-Based Transaction Sync (Optimization)

**Status:** Not Started  
**Estimated Time:** 2-3 hours  
**Priority:** Low (optimization)

Upgrade from `transactionsGet` to `transactionsSync` for more efficient syncing.

**Current Implementation:**

- Uses `transactionsGet` with 30-day date range
- Checks for duplicates manually by `plaid_transaction_id`
- Works but fetches all transactions every time

**Upgraded Implementation:**

- Use `transactionsSync` with cursor
- Store cursor in `linked_accounts.plaid_cursor`
- Only fetch new/modified/deleted transactions
- More efficient at scale

**Database Changes:**

```sql
ALTER TABLE public.linked_accounts
ADD COLUMN plaid_cursor TEXT;
```

**Benefits:**

- Faster syncs (only delta)
- Handles transaction modifications
- Handles transaction deletions
- Plaid-recommended approach

**Reference:** GitHub Issue #18 comment by @JPCompany544

---

## 11. Advanced Filtering Enhancements (Future)

**Status:** Not Started  
**Estimated Time:** 4-6 hours total  
**Dependencies:** Issue #30 (Transaction Filtering) âœ…  
**Priority:** Low - Nice to have for V2.0

Enhancements to the transaction filtering system added in Issue #30.

**Potential Features:**

### 11a. Fuzzy Search Matching

- Use Fuse.js or similar for typo-tolerant search
- "starbuks" would match "Starbucks"
- Estimated: 1-2 hours

### 11b. Saved Filter Presets

- Let users save frequently used filter combinations
- "My Subscriptions" = recurring + personal
- Store in localStorage or database
- Estimated: 2-3 hours

### 11c. Filter by Partner

- Add "Who paid" filter: Me / Partner / Anyone
- Useful for households with split responsibilities
- Estimated: 30 min

### 11d. Filter by Bank Account/Source

- Filter by linked account (Chase, Wells Fargo, etc.)
- Filter by source (Plaid vs Manual)
- Estimated: 1 hour

### 11e. Export Filtered Results

- Ties into Issue #32 (Export to CSV)
- "Export Current View" button
- Include filter criteria in filename
- Estimated: Included in #32

**Implementation Notes:**

- These build on the existing filter architecture
- Can be added incrementally
- Consider user feedback before prioritizing

---

## Priority Order (Recommended)

1. ~~**Transaction History/Filtering**~~ âœ… Completed (Issue #30)
2. ~~**Budget Progress Bars**~~ âœ… Completed (Issue #27)
3. ~~**Household Settings Page**~~ âœ… Completed (Multiple Issues)
4. **Spending Trends Chart** (Visual appeal for demos)
5. **Hide from Partner Toggle** (Nice to have for privacy)
6. **Single-Use Invite Codes** (Security improvement)
7. **Robust Plaid Error Handling** (Reliability improvement)
8. **Recurring Bill Detective** (Lower priority, can be V2.0)
9. **Cursor-Based Transaction Sync** (Optimization, low priority)
10. **Goal Auto-Sync** (Complex, can be V2.0)
11. **Advanced Filtering Enhancements** (V2.0 polish)

---

## Notes

- These features build on the MVP foundation
- Each is independent and can be built in any order
- Prioritize based on beta user feedback (Feb 1-15)
- If timeline is tight, move lower-priority items to V2.0

---

## Technical Improvements (Future Consideration)

These are not user-facing features but technical improvements to consider as the app scales.

---

### TanStack Query Migration

**Status:** Not Planned (Evaluate at V2.0+)  
**Estimated Time:** 4-6 hours  
**Priority:** Low

**When to Consider:**

- If adding more client-side interactive features
- If needing sophisticated caching across pages
- If building offline-first capabilities
- If the app grows to 10+ pages with shared data

**Benefits:**

- Built-in caching and cache invalidation
- Automatic background refetching
- Better DevTools for debugging data flow
- Optimistic updates with automatic rollback
- Reduces boilerplate for data fetching

**Current Approach (MVP):**

- Server Components for data fetching (no client-side fetch needed)
- `router.refresh()` for re-fetching after mutations
- `useState` for optimistic updates
- Works well for current app size and complexity

**Decision:** Revisit after V2.0 if app complexity increases significantly. Not needed for MVP or V1.1.

---

### Other Future Technical Considerations

These may be worth exploring as the app matures:

| Improvement                  | When to Consider      | Benefit                       |
| ---------------------------- | --------------------- | ----------------------------- |
| React Query / TanStack Query | 10+ interactive pages | Caching, background refetch   |
| Zustand or Jotai             | Complex client state  | Simpler than Redux            |
| Plaid Webhooks               | Production scale      | Real-time transaction updates |
| Edge Functions               | High traffic          | Faster API responses          |
| Database Connection Pooling  | 100+ concurrent users | Better performance            |

---
